Project: Schwab AI Investment Dashboard (SAID)
1. å°ˆæ¡ˆæ¦‚è¿° (Overview)
é–‹ç™¼ä¸€å€‹åŸºæ–¼ Web çš„æŠ•è³‡çµ„åˆç®¡ç†å„€è¡¨æ¿ï¼Œä¸²æ¥ Charles Schwab Trader APIã€‚è©²ç³»çµ±æ—¨åœ¨æä¾›è¶…è¶Šåˆ¸å•†åŸç”Ÿä»‹é¢çš„æ•¸æ“šåˆ†æï¼ŒåŒ…å«å³æ™‚è³‡ç”¢ç›£æ§ã€é¢¨éšªæŒ‡æ¨™åˆ†æ (VAR, Beta)ã€GICS ç”¢æ¥­åˆ†ä½ˆä»¥åŠ AI æŠ•è³‡è¼”åŠ©å»ºè­°ã€‚ç³»çµ±éœ€å…·å‚™ Demo æ¨¡å¼ä»¥ä¾¿åœ¨ç„¡ API é€£ç·šæ™‚å±•ç¤ºåŠŸèƒ½ã€‚

2. æŠ€è¡“æ¶æ§‹ (Tech Stack)
Frontend: React (Vite/Next.js), TypeScript, Tailwind CSS, Recharts (åœ–è¡¨).

Backend: Python (FastAPI), Pandas (æ•¸æ“šåˆ†æ), NumPy (é‡‘èè¨ˆç®—).

Database: SQLite/PostgreSQL (å„²å­˜æ­·å²å¿«ç…§ã€äº¤æ˜“è¨˜éŒ„).

External API: Schwab Trader API (OAuth 2.0, Market Data API).

Docs: Markdown (overview.md, todo_progress.md).

3. åŠŸèƒ½éœ€æ±‚æ¸…å–® (Feature Requirements)
3.1 æ ¸å¿ƒç³»çµ±èˆ‡åŸºç¤è¨­æ–½ (Infrastructure)

èº«ä»½é©—è­‰ (Auth): å¯¦ä½œ Schwab OAuth æµç¨‹ç™»å…¥ï¼ŒåŒ…å« Token ç®¡ç†ã€è‡ªå‹•åˆ·æ–° (Refresh Token) ã€é€£ç·šç‹€æ…‹ç›£æ§åŠä¸€éµé‡æ–°æˆæ¬Šæµç¨‹ã€‚


æ•¸æ“šæ•´åˆ (Data Integration): èšåˆå¸³æˆ¶é¤˜é¡ã€æŒå€‰ã€è¨‚å–®ç‹€æ…‹ ã€‚


Demo æ¨¡å¼: æä¾›ä¸€å€‹åˆ‡æ›é–‹é—œï¼Œé–‹å•Ÿæ™‚ä½¿ç”¨é è¨­çš„ Mock Data (å‡è³‡æ–™) å‘ˆç¾æ‰€æœ‰åœ–è¡¨èˆ‡å¡ç‰‡ï¼Œæ–¹ä¾¿å±•ç¤ºèˆ‡ UI æ¸¬è©¦ ã€‚


ç·©å­˜æ©Ÿåˆ¶ (Caching): é‡å°éå³æ™‚è®Šå‹•æ•¸æ“š (å¦‚åŸºæœ¬é¢è³‡æ–™) å»ºç«‹å¿«å–ï¼Œé¿å…è§¸ç™¼ API Rate Limit ã€‚

3.2 ç¸½è¦½å„€è¡¨æ¿ (Dashboard)
ä½œç‚ºç™»å…¥å¾Œçš„é¦–é ï¼Œæä¾›é«˜è¦–è§’çš„è³‡ç”¢å¿«ç…§ï¼š

é—œéµæŒ‡æ¨™å¡ç‰‡ (KPI Cards):

ç¸½è³‡ç”¢ (Total Net Liquidation) ã€‚

ç•¶æ—¥ç›ˆè™§ (Day P/L) & ç›ˆè™§ç™¾åˆ†æ¯” ã€‚

å¹´åº¦è‡³ä»Šç›ˆè™§ (YTD P/L) & ç™¾åˆ†æ¯” ã€‚

ç¾é‡‘æ°´ä½ (Cash Balance) èˆ‡ è³¼è²·åŠ› (Buying Power) ã€‚

æ ¸å¿ƒåœ–è¡¨:


æ·¨å€¼èµ°å‹¢åœ– (Net Worth History): å¯åˆ‡æ›æ™‚é–“ç¶­åº¦ (3M, 6M, YTD, 1Y, 3Y, All) ã€‚


ç¾é‡‘æ°´ä½è®ŠåŒ–åœ–: ç›£æ§ç¾é‡‘åœ¨è³‡ç”¢ä¸­çš„ä½”æ¯”è¶¨å‹¢ ã€‚

3.3 æŠ•è³‡çµ„åˆç®¡ç† (Portfolio Management)

æŒè‚¡åˆ—è¡¨ (Holdings Table): 

åˆ†åˆ¥è‚¡ç¥¨èˆ‡é¸æ“‡æ¬Šä½¿ç”¨ä¸åŒæ¬„ä½

æ¬„ä½: ä»£ç¢¼ã€åç¨±ã€æ•¸é‡(å°æ•¸é»3ä½)ã€æˆæœ¬ã€ç¾åƒ¹ã€å¸‚å€¼ã€è³‡é‡‘ä½”æ¯” (Weight)ã€æœªå¯¦ç¾æç›Š (Unrealized P/L)ã€ç¸½å ±é…¬ç‡ (%)ã€æŒå€‰ä½”æ¯”ã€‚
æ¬„ä½è¦å¯ä»¥æ’åº

åŠŸèƒ½: æ”¯æ´é»æ“Šæ¬„ä½æ’åº (Sorting)ã€é—œéµå­—æœå°‹ç¯©é¸ ã€‚


åˆ†é¡æ¨™ç±¤: æ”¯æ´è‡ªå®šç¾©æ¨™ç±¤ (å¦‚: è‚¡æ¯è‚¡ã€æˆé•·è‚¡ã€ETF) èˆ‡ GICS è‡ªå‹•åˆ†é¡ ã€‚

è³‡ç”¢åˆ†ä½ˆåˆ†æ (Allocation):


åœ“é¤…åœ– 1 (Asset Class): è‚¡ç¥¨ vs ç¾é‡‘ vs é¸æ“‡æ¬Š vs å‚µåˆ¸ ã€‚


åœ“é¤…åœ– 2 (Sector): ä¾ç…§ GICS (Global Industry Classification Standard) é¡¯ç¤ºç”¢æ¥­åˆ†ä½ˆ (å¦‚ Technology, Healthcare) ã€‚


ç´°åˆ†ç”¢æ¥­åœ– (Industry Group): é¡¯ç¤ºæ›´ç´°é …çš„ç”¢æ¥­æ›éšª (å¦‚ Semiconductor, Software) ã€‚

3.4 é¢¨éšªåˆ†æ (Risk Analysis)
æ­¤æ¨¡çµ„éœ€é‹ç”¨ Python pandas/numpy é€²è¡Œè¨ˆç®—ï¼š


æ³¢å‹•æ€§æŒ‡æ¨™: è¨ˆç®—æŠ•è³‡çµ„åˆçš„å¹´åŒ–æ³¢å‹•ç‡ï¼Œæ¡ Business Day Resampling ä¸¦éæ¿¾ç•°å¸¸æ•¸æ“šã€‚


é¢¨éšªå€¼ (VaR): ä½¿ç”¨æ­·å²æ¨¡æ“¬æ³• (Historical Simulation) è¨ˆç®— 95% ä¿¡å¿ƒæ°´æº–ä¸‹çš„é¢¨éšªå€¼ã€‚


Beta ä¿‚æ•¸: åŸºæ–¼éå» 1 å¹´ Schwab Market Data è¨ˆç®—ç›¸å°æ–¼ SPY çš„è¿´æ­¸ Betaï¼Œä¸¦å…·å‚™æ¬Šé‡ Beta å‚™æ´ã€‚


å¤šç©ºåˆ†æ: é¡¯ç¤º å¤šé ­ (Long) vs ç©ºé ­ (Short) çš„è³‡é‡‘æ¯”ä¾‹ ã€‚


é›†ä¸­åº¦åˆ†æ: è¨ˆç®—å‰ 5 å¤§æŒè‚¡ä½”ç¸½è³‡ç”¢çš„æ¯”ä¾‹ (Top 5 Concentration)ï¼Œè‹¥éé«˜éœ€é¡¯ç¤ºè­¦ç¤º ã€‚


æ§“æ¡¿ç›£æ§: é¡¯ç¤ºç•¶å‰æ§“æ¡¿æ¯”ç‡ (Leverage Ratio) ã€‚

3.5 ç¸¾æ•ˆèˆ‡æ”¶ç›Š (Performance & Income)

ç¸¾æ•ˆåˆ†æ: æ¯”è¼ƒæŠ•è³‡çµ„åˆ vs åŸºæº–æŒ‡æ•¸ (S&P 500, Nasdaq) çš„ç¸¾æ•ˆèµ°å‹¢ ã€‚


æ”¶ç›Šè¨˜éŒ„: è¨˜éŒ„è‚¡æ¯ (Dividend) èˆ‡å·²å¯¦ç¾æç›Š (Realized P/L)ï¼Œä¸¦ç¹ªè£½æ¯æœˆæ”¶å…¥æŸ±ç‹€åœ– ã€‚

3.6 AI è¼”åŠ©æŠ•è³‡ (AI Copilot)
æ•´åˆ LLM (å¦‚ OpenAI/Gemini API)ï¼š

æ ¹æ“šæŒå€‰çµæ§‹æä¾›ç°¡å–®çš„å†å¹³è¡¡å»ºè­°ã€‚

é‡å°ç‰¹å®šè‚¡ç¥¨é€²è¡Œæ–°èæ‘˜è¦æˆ–åŸºæœ¬é¢è§£è®€ ã€‚

4. æ–‡ä»¶èˆ‡å°ˆæ¡ˆç®¡ç† (Documentation)

overview.md: ç³»çµ±æ¶æ§‹åœ–ã€API ä¸²æ¥èªªæ˜ã€ä¿®æ”¹æ­·ç¨‹ (Changelog) ã€‚


todo_progress.md: æ‹†è§£å¾Œçš„ä»»å‹™æ¸…å–®ï¼ŒåŒ…å« [ ] Todo, [x] Done, [-] In Progress ç‹€æ…‹ ã€‚

## 5. å·²çŸ¥è¨­è¨ˆèˆ‡é™åˆ¶ (Known Issues & Design Choices)
*   **è‚¡æ¯è¨ˆç®—**: ç›®å‰ã€Œç´¯ç©è‚¡æ¯ã€é¡¯ç¤ºç‚ºå…¨æœŸç¸½å’Œï¼ŒåŒ…å«ç¾é‡‘è‚¡æ¯èˆ‡ DRIP (è‚¡æ¯å†æŠ•å…¥)ã€‚DRIP äº¤æ˜“åœ¨ CSV ä¸­æœƒè¢«è­˜åˆ¥ç‚ºã€Œè‚¡æ¯æ”¶å…¥ (Income)ã€èˆ‡ã€Œè‚¡ç¥¨è²·å…¥ (Buy)ã€å…©éƒ¨åˆ†ã€‚
*   **æœ¬é‡‘æ ¡æ­£**: ç”±æ–¼ Schwab API ç„¡æ³•å–å¾— 2 å¹´å‰çš„æ­·å²æœ¬é‡‘èˆ‡äº¤æ˜“ï¼Œç³»çµ±å®£å¯¦ä½œäº† `MANUAL_ADJUSTMENTS` æ©Ÿåˆ¶ï¼Œçµåˆæ­·å² CSV åŒ¯å…¥æ•¸æ“šä¾†ç²¾ç¢ºè¨ˆç®—ã€Œç¸½å ±é…¬ã€ã€‚
*   **å¤šå¸³æˆ¶éš”é›¢**: æ•¸æ“šè¡¨ (Dividend, TradeHistory) å·²å¼•å…¥ `account_hash` æ¬„ä½ä»¥æ”¯æ´å¤šå¸³æˆ¶æ•¸æ“šç®¡ç†ã€‚

## 6. é¢¨éšªåˆ†æé‚è¼¯ (Risk Analysis Logic)
*   **å¹´åŒ–å ±é…¬ç‡ (Annual Return)**: æ¡ã€Œç¸½å ±é…¬å¹´åŒ–æ³• (Total Return Annualization)ã€ï¼ŒåŸºæ–¼æœ¬é‡‘æ ¡æ­£å¾Œçš„ç¸½å ±é…¬èˆ‡æŒæœ‰å¤©æ•¸åæ¨ï¼Œæ’é™¤è³‡é‡‘æµé›œè¨Šã€‚
*   **æœ€å¤§å›æ’¤ (Max Drawdown)**: åŸºæ–¼ã€Œå¹¾ä½•ç´¯è¨ˆæ”¶ç›Šç‡ (Geometric Cumulative Returns)ã€è¨ˆç®—ï¼Œç¢ºä¿å¸³æˆ¶é–“å¤§é¡è½‰å¸³ä¸æœƒé€ æˆè™›å‡å›æ’¤ã€‚
*   **é¢¨éšªå€¼ (VaR)**: æ¡ã€Œåƒæ•¸æ³• (Parametric VaR)ã€ï¼Œä»¥ 95% ä¿¡å¿ƒæ°´æº–çµåˆå¯¦éš›å¹´åŒ–æ³¢å‹•ç‡ä¼°ç®—å–®æ—¥æœ€å¤§é æœŸæå¤±ã€‚
*   **æ•¸æ“šéæ¿¾**: è‡ªå‹•è­˜åˆ¥ä¸¦æ­¸é›¶æ—¥å ±é…¬ç‡è¶…é 10% çš„ç•°å¸¸å€¼ï¼ˆåˆ¤å®šç‚º Net Flow è³‡é‡‘ç•°å‹•ï¼‰ã€‚

## 7. UI/UX è¨­è¨ˆæº–å‰‡
é¢¨æ ¼: ç¾ä»£åŒ–æ·±è‰²æ¨¡å¼ (Dark Mode)ï¼Œé¡ä¼¼å½­åšçµ‚ç«¯æ©Ÿæˆ– IB TWS çš„å°ˆæ¥­æ„Ÿã€‚

éŸ¿æ‡‰å¼: æ”¯æ´ Desktop ç‚ºä¸»ï¼Œä½†éœ€é©é… Tabletã€‚


å¡ç‰‡å¼è¨­è¨ˆ: æ‰€æœ‰åŠŸèƒ½æ¨¡çµ„ä»¥ Card å½¢å¼å‘ˆç¾ï¼Œç‰ˆé¢ä¹¾æ·¨ ã€‚

## 7. é–‹ç™¼æº–å‰‡ (Development Guidelines)
* **Atomic Tasks Only:** è«‹åš´æ ¼éµå®ˆã€ŒåŸå­åŒ–ä»»å‹™ã€åŸå‰‡ã€‚
* **Small Scope:** æ¯å€‹ Step çš„ä»»å‹™ç¯„åœå¿…é ˆé™åˆ¶åœ¨ **15 åˆ†é˜å…§** å¯å®Œæˆçš„å·¥ä½œé‡.
* **No Monoliths:** ç¦æ­¢ä¸€æ¬¡æ€§ç”Ÿæˆéé•·çš„ç¨‹å¼ç¢¼ã€‚å¦‚æœæ˜¯è¤‡é›œåŠŸèƒ½ï¼ˆå¦‚ Dashboard UIï¼‰ï¼Œè«‹æ‹†è§£ç‚ºï¼š1. å»ºç«‹ç©ºçµ„ä»¶, 2. å®šç¾© Type, 3. å¯¦ä½œ API å‘¼å«, 4. ç¶å®šè³‡æ–™, 5. ç¾åŒ–æ¨£å¼ã€‚
* **TDD First:** æ¶‰åŠé‚è¼¯è¨ˆç®—æ™‚ï¼Œå„ªå…ˆæ’°å¯«æ¸¬è©¦æ¡ˆä¾‹ã€‚

## 8. ä¿®æ”¹æ—¥èªŒ (Change Log)
- [2026-01-09] [Roo] ä¿®æ­£ AccountRepository åˆå§‹åŒ– 500 éŒ¯èª¤ï¼šæ›´æ­£ __init__ åƒæ•¸ç°½ç« ä»¥æ¥æ”¶ db Sessionï¼Œä¸¦ç§»é™¤å…¨åŸŸéŒ¯èª¤å¯¦ä¾‹ï¼Œç¢ºä¿èˆ‡ FastAPI ä¾è³´æ³¨å…¥æ©Ÿåˆ¶ç›¸å®¹ã€‚
- [2026-01-09] [Roo] ä¿®æ­£å¸³æˆ¶åˆ—è¡¨ 404 éŒ¯èª¤ï¼šåœ¨ account.py ä¸­æ–°å¢ /list è·¯ç”±ï¼Œä¸¦åœ¨ MockRepository èˆ‡ AccountRepository ä¸­åŒæ­¥å¯¦ä½œ get_accounts() æ–¹æ³•ï¼Œæ¢å¾©å¸³æˆ¶é¸æ“‡å™¨åŠŸèƒ½ã€‚
- [2026-01-09] [Roo] ä¿®å¾©å¸³æˆ¶é¸æ“‡å™¨æ¶ˆå¤±å•é¡Œï¼šå„ªåŒ– Dashboard.tsx çš„å¸³æˆ¶è¼‰å…¥èˆ‡è‡ªå‹•é¸å–é‚è¼¯ï¼ˆå„ªå…ˆé¸å–ç¬¬äºŒå¸³æˆ¶ï¼‰ï¼ŒåŠ å…¥é—œéµæ—¥èªŒèˆ‡ Loading ä½”ä½ç¬¦ï¼Œç¢ºä¿é¸å–å¾Œè§¸ç™¼è³‡æ–™åŸ·è¡Œã€‚
- [2026-01-09] [Roo] å¼·åˆ¶ä¿®å¾©æŒå€‰ä¸é¡¯ç¤ºå•é¡Œï¼šæ”¾å¯¬å‰ç«¯ Dashboard.tsx çš„éæ¿¾æ¢ä»¶ï¼ˆä¸åˆ†å¤§å°å¯«ä¸¦æ”¯æŒå¤šç¨®æ¨™ç±¤ï¼‰ï¼ŒåŠ å…¥é—œéµ Debug Logï¼Œä¸¦å†æ¬¡é©—è­‰ Mock è³‡æ–™èˆ‡å¾Œç«¯æ¨¡å‹çš„ä¸€è‡´æ€§ã€‚
- [2026-01-09] [Roo] æ·±åº¦ä¿®å¾©æŒå€‰æ˜ç´°é¡¯ç¤ºï¼šçµ±ä¸€å‰å¾Œç«¯ Position æ¬„ä½åç¨± (open_pl, cost_basis, current_price ç­‰)ï¼Œä¿®æ­£ Pydantic æ¨¡å‹é…ç½® (`from_attributes=True`)ï¼Œå„ªåŒ–å‰ç«¯éæ¿¾é‚è¼¯ç‚ºä¸åˆ†å¤§å°å¯«ï¼Œä¸¦åŠ å…¥åµéŒ¯æ—¥èªŒä»¥ç¢ºä¿è³‡æ–™é¡¯ç¤ºã€‚
- [2026-01-09] [Roo] æ¢å¾© HoldingsTable å®Œæ•´æ¬„ä½é¡¯ç¤ºèˆ‡å‹åˆ¥å®šç¾©ï¼Œæ–°å¢ cost_basis, day_pl, open_pl, allocation_pct æ¬„ä½ï¼Œä¸¦å¯¦ä½œæç›Šé¡è‰²èˆ‡æ•¸å€¼é®ç½©é‚è¼¯ã€‚
- [2026-01-12] [Roo] ä¿®å¾©ç”¢æ¥­åˆ†ä½ˆåœ“é¤…åœ–èˆ‡è¯å‹•ç¯©é¸ï¼šä¿®å¾©å¾Œç«¯ `sector` æå–é‚è¼¯ï¼Œä¿®æ­£å‰ç«¯å‹åˆ¥èˆ‡æ¸²æŸ“é«˜åº¦å•é¡Œï¼Œä¸¦å¯¦ä½œé»æ“Šåœ“é¤…åœ–è‡ªå‹•éæ¿¾æŒå€‰åˆ—è¡¨çš„åŠŸèƒ½ã€‚
- [2026-01-12] [Roo] é…ç½® Vite Proxy èˆ‡ç›¸å°è·¯å¾‘ APIï¼šè§£æ±ºè·¨è£ç½® (è¡Œå‹•ç«¯) å­˜å–å¾Œç«¯ API å¤±æ•—çš„å•é¡Œï¼Œç¾åœ¨å‰ç«¯ç¶“ç”± Vite ä»£ç†è½‰ç™¼è«‹æ±‚è‡³å¾Œç«¯ã€‚
- [2026-01-12] [Roo] é‡æ§‹ API Key ç®¡ç†èˆ‡æŒä¹…åŒ–ï¼šå°‡ API Key å„²å­˜ä½ç½®å¾å‰ç«¯ç§»è‡³å¾Œç«¯è³‡æ–™åº« (SQLite)ï¼Œå¯¦ä½œ API Key çš„é®ç½©é¡¯ç¤ºèˆ‡å¤šè¨­å‚™åŒæ­¥åŠŸèƒ½ã€‚
- [2026-01-12] [Roo] å¯¦ä½œ Token æŒä¹…åŒ–èˆ‡è‡ªå‹•åˆ·æ–°ï¼šå°‡ Schwab OAuth Token å„²å­˜è‡³è³‡æ–™åº«ï¼Œç§»é™¤äº†å° `token.json` æª”æ¡ˆçš„ä¾è³´ï¼Œä¸¦å¯¦ä½œäº† Token éæœŸæ™‚çš„è‡ªå‹•åˆ·æ–°èˆ‡è³‡æ–™åº«æ›´æ–°æ©Ÿåˆ¶ã€‚
- [2026-01-12] [Roo] å¼·åˆ¶ Token åŒæ­¥èˆ‡åŒ¯å…¥å·¥å…·ï¼šå„ªåŒ– SchwabClient å•Ÿå‹•é‚è¼¯ï¼Œæ”¯æ´å¤šè·¯å¾‘ (Root/Backend) è‡ªå‹•åµæ¸¬ `token.json` ä¸¦å¼·åˆ¶åŒæ­¥è‡³è³‡æ–™åº«ï¼Œæä¾›å®‰å…¨çš„æ™‚é–“æˆ³è¨˜å‚™ä»½æ©Ÿåˆ¶ã€‚
- [2026-01-13] [Roo] æ·±åº¦ä¿®å¾©èªè­‰æŒä¹…åŒ–æ ¼å¼èˆ‡æ•¸æ“šåŒæ­¥ï¼šä¿®æ­£ `SchwabClient` çš„ Token è®€å–/å„²å­˜åŒ…è£é‚è¼¯ï¼Œç¢ºä¿èˆ‡ `schwab-py` çš„ Metadata é©—è­‰ç›¸å®¹ï¼›å®ŒæˆæŒå€‰åç¨±è§£æå„ªåŒ–ï¼Œè§£æ±ºåŒæ­¥å´©æ½°å•é¡Œã€‚
- [2026-01-13] [Roo] ç³»çµ±ç©©å®šæ€§å¼·åŒ–ï¼šè§£æ±ºè·¨è£ç½® (è¡Œå‹•ç«¯) é€£ç·šã€API é‡‘é‘°/Token è³‡æ–™åº«åŒæ­¥ã€ä»¥åŠ Windows æª”æ¡ˆæ¬Šé™å°è‡´çš„å‚™ä»½è¡çªç­‰é—œéµå›æ­¸å•é¡Œï¼Œç¢ºä¿ç³»çµ± 100% è„«é›¢æª”æ¡ˆä¾è³´ã€‚
- [2026-01-13] [Roo] ä¿®å¾©ç”¢æ¥­åˆ†ä½ˆåœ“é¤…åœ–ï¼šå¯¦ä½œ `sector_mapper.py` è£œè¶³ Schwab API ç¼ºå¤±çš„ GICS è¡Œæ¥­è³‡è¨Šï¼Œä¿®å¾© Token è‡ªå‹•åˆ·æ–°å´©æ½°å•é¡Œï¼Œä¸¦çµ±ä¸€å¾Œç«¯æ•¸æ“šåŒæ­¥é‚è¼¯ï¼Œè§£æ±ºåœ“é¤…åœ–åƒ…é¡¯ç¤º "Other" çš„å•é¡Œã€‚
- [2026-01-13] [Roo] ç”¢æ¥­åˆ†ä½ˆåœ–ä¸­æ–‡åŒ–ï¼šåœ¨ `AllocationChart.tsx` ä¸­å¯¦ä½œè¡Œæ¥­åç¨±å°ç…§è¡¨ï¼Œå°‡ GICS ç”¢æ¥­åˆ†é¡ç¿»è­¯ç‚ºç¹é«”ä¸­æ–‡ï¼Œå„ªåŒ–åœ–ä¾‹ (Legend) èˆ‡å·¥å…·æç¤º (Tooltip) çš„é¡¯ç¤ºé«”é©—ã€‚
- [2026-01-13] [Roo] å„ªåŒ–é¢¨éšªåˆ†æ Beta è¨ˆç®—èˆ‡å¸³æˆ¶åˆ‡æ›ï¼šå¯¦ä½œæŒå€‰åŠ æ¬Š Beta (Ex-ante Beta) é‚è¼¯ä»¥ä¿®å¾© SSL å ±éŒ¯å°è‡´çš„ç•°å¸¸æ•¸å€¼ï¼›åœ¨ã€Œé¢¨éšªåˆ†æã€é é¢æ–°å¢å¸³æˆ¶åˆ‡æ›å™¨ä¸¦æ”¯æ´å¾Œç«¯ `account_hash` åƒæ•¸éæ¿¾ã€‚
- [2026-01-13] [Roo] æ›´æ–° Dashboard å¡ç‰‡èˆ‡ç³»çµ±æ¶æ§‹åœ–ï¼šå°‡é¦–é ã€Œè³¼è²·åŠ›ã€å¡ç‰‡æ›¿æ›ç‚ºã€ŒBeta ä¿‚æ•¸ã€é¡¯ç¤ºï¼›å»ºç«‹ `backend/app/utils/risk.py` æ¨¡çµ„åŒ–é¢¨éšªè¨ˆç®—é‚è¼¯ä¸¦åŒæ­¥æ›´æ–° `overview.md` ç›®éŒ„çµæ§‹ã€‚
- [2026-01-13] [Roo] ä¿®å¾© Dashboard ç•¶æ—¥ç›ˆè™§ (Day P/L) é¡¯ç¤ºç‚º 0 çš„å•é¡Œï¼šä¿®æ­£ `schwab_client.py` ä¸­åŸæœ¬éŒ¯èª¤å°æ‡‰åˆ° `totalCash` çš„é‚è¼¯ï¼Œæ”¹ç‚ºå‹•æ…‹ç´¯åŠ æ‰€æœ‰æŒå€‰çš„ `dayProfitLoss` ä¸¦å¯¦ä½œç›ˆè™§ç™¾åˆ†æ¯”è¨ˆç®—ã€‚
- [2026-01-13] [Roo] æ·±åº¦ä¿®å¾©ã€Œç´¯è¨ˆè‚¡æ¯ (YTD Dividends)ã€æ•¸æ“šç•°å¸¸ï¼š
    - è³‡æ–™åº«è®Šæ›´ï¼šåœ¨ `persistence.py` ä¸­çš„ `Dividend` èˆ‡ `TradeHistory` æ¨¡å‹æ–°å¢ `account_hash` æ¬„ä½ï¼Œå¯¦ç¾å¤šå¸³æˆ¶æ•¸æ“šéš”é›¢ã€‚
    - é‚è¼¯æ›´æ–°ï¼šåœ¨ `schwab_client.py` æ¡ç´ã€Œåˆä½µè¨ˆç®—ç­–ç•¥ã€ï¼ŒåŒæ™‚è¿½è¹¤ `DIVIDEND_OR_INTEREST` èˆ‡æè¿°å« "Div/DRIP" çš„äº¤æ˜“ã€‚
    - æ”¶ç›Šçµ±è¨ˆå„ªåŒ–ï¼šå¯¦ä½œ `abs()` çµ•å°å€¼åŠ ç¸½ä»¥æ­£ç¢ºçµ±è¨ˆè² å€¼çš„å†æŠ•å…¥ (DRIP) äº¤æ˜“ï¼Œä¸¦å°‡æŸ¥è©¢ç¯„åœåš´æ ¼é–å®šç‚ºæœ¬å¹´åº¦ (YTD)ï¼Œæ’é™¤æ­·å²æ•¸æ“šå¹²æ“¾ã€‚
- [2026-01-13] [Roo] ä¿®å¾©è³‡ç”¢è¶¨å‹¢åœ– (Asset History Chart) æ•¸æ“šé¡¯ç¤ºå•é¡Œï¼š
    - ç¢ºèªå˜‰ä¿¡åŒ¯å‡ºçš„ "Balances" CSV éœ€ç‚ºæ­·å²ç´€éŒ„æ ¼å¼ (Date, Amount) æ‰èƒ½ç¹ªè£½è¶¨å‹¢ã€‚
    - å„ªåŒ– `import_history_csv.py` æ”¯æ´è§£æ `M/D/YYYY` æ—¥æœŸæ ¼å¼èˆ‡æ¸…æ´—å¸¶æœ‰ $ ç¬¦è™Ÿçš„é‡‘é¡ã€‚
    - ä¿®æ”¹ `analytics.py` å¯¦ä½œ `HistoricalBalance` (èˆŠè³‡æ–™) èˆ‡ `AssetHistory` (Liveè³‡æ–™) çš„åˆä½µæŸ¥è©¢é‚è¼¯ï¼Œä¸¦çµ±ä¸€æ—¥æœŸæ ¼å¼ç‚º `YYYY-MM-DD`ã€‚
    - å‰ç«¯åœ–è¡¨åŠ å…¥ `connectNulls` èˆ‡æ™ºèƒ½ Hash åŒ¹é…ï¼Œè§£æ±ºæ–·é»èˆ‡å¸³è™Ÿè¯å‹•å•é¡Œã€‚
    - èª¿æ•´å·²å¯¦ç¾æç›Š (Realized P&L) è¨ˆç®—ç‚ºå…¨æœŸ (All-time) ç´¯è¨ˆã€‚
- [2026-01-14] [Roo] é‡æ§‹ Dashboard KPIï¼šå°‡ã€Œå·²å¯¦ç¾æç›Šã€æ›´æ›ç‚ºã€Œç¸½å ±é…¬ (Total Return)ã€ï¼Œå¯¦ä½œåŸºæ–¼æ·¨æŠ•å…¥æœ¬é‡‘çš„ç¸¾æ•ˆè¨ˆç®—ã€‚
- [2026-01-14] [Roo] å¼·åŒ–æ•¸æ“šç²¾ç¢ºåº¦ï¼šç‚º `TradeHistory` å¼•å…¥ `transaction_id` å”¯ä¸€ç´¢å¼•èˆ‡ `description` æ¬„ä½ï¼Œå„ªåŒ– `JOURNAL` è­˜åˆ¥é‚è¼¯ä¸¦æœçµ•é‡è¤‡åˆ†éŒ„ã€‚
- [2026-01-14] [Roo] æœ¬é‡‘æ ¡æ­£èˆ‡ CSV åŒ¯å…¥ï¼šå¯¦ä½œ `MANUAL_ADJUSTMENTS` è£œè¶³ TD æ­·å²æœ¬é‡‘ï¼Œä¸¦é–‹ç™¼å°ˆç”¨å·¥å…·åŒ¯å…¥ç¼ºå¤±çš„æ­·å² CSV äº¤æ˜“åˆ†éŒ„ã€‚
- [2026-01-15] [Roo] æ·±åº¦ä¿®å¾©ã€Œç´¯ç©è‚¡æ¯ã€èˆ‡ã€Œæ•¸æ“šé‡è¤‡ã€ï¼šç§»é™¤è‚¡æ¯è¨ˆç®—çš„å¹´åº¦é™åˆ¶ï¼Œæ”¹ç‚ºå…¨æœŸçµ±è¨ˆã€‚å¯¦ä½œ CSV äº¤æ˜“åŒ¯å…¥å·¥å…· (`import_transactions_csv.py`) ä¸¦æ¸…ç†äº† 133 ç­†ä¾†è‡ª Schwab/TD é‡ç–Šçš„é‡è¤‡ç´€éŒ„ã€‚
- [2026-01-16] [Roo] é¢¨éšªæŒ‡æ¨™ä¿®å¾© Phase 1ï¼šæ•¸æ“šæºé·ç§»è‡³ Schwab API è§£æ±º SSL é©—è­‰å•é¡Œï¼›å¯¦ä½œ Business Day Resampling ä¿®å¾© Volatility æŒ‡æ¨™ã€‚
- [2026-01-16] [Roo] é¢¨éšªæŒ‡æ¨™ä¿®å¾© Phase 2ï¼šé‡æ§‹ Annual Return (Total Return æ³•) èˆ‡ Max Drawdown (å¹¾ä½•æ”¶ç›Šç‡æ³•)ï¼Œå¾¹åº•è§£æ±ºå¤§é¡è½‰å¸³å°è‡´çš„æŒ‡æ¨™åå·®ï¼›VaR æ”¹ç”¨åƒæ•¸æ³•æå‡ç§‘å­¸æ€§ã€‚
- [2026-01-16] [Roo] CSV åŒ¯å…¥åŠŸèƒ½èˆ‡ç³»çµ±è¨­å®šå„ªåŒ–ï¼šå¯¦ä½œ `ImporterService` è™•ç†æ­·å²æ•¸æ“šåŒ¯å…¥ï¼ŒSettings é é¢æ–°å¢ Drag & Drop ä¸Šå‚³èˆ‡ã€Œé€£æ¥/é‡æ–°æˆæ¬Šã€æŒ‰éˆ•ã€‚
- [2026-01-20] [Roo] ç³»çµ±ç§»æ¤èˆ‡ OAuth æµç¨‹æ·±åº¦å„ªåŒ– (New Computer Setup):
    - ç’°å¢ƒä¿®å¾©: è§£æ±º Python 3.14 ç’°å¢ƒä¸‹ pip èˆ‡ sqlalchemy éºå¤±å°è‡´è³‡æ–™åº«ç„¡æ³•è®€å–çš„å•é¡Œã€‚
    - æˆæ¬Šæµç¨‹ç¾ä»£åŒ–: 
        - å¯¦ä½œã€Œå½ˆçª—æˆæ¬Š (Pop-up Window)ã€èˆ‡ã€Œæ‰‹å‹•è²¼å…¥ URL/Codeã€ä»‹é¢ï¼Œè§£æ±ºæœ¬åœ°é–‹ç™¼ç’°å¢ƒ (127.0.0.1) ç„¡æ³•è¢«å…¬ç¶²å›å‚³æˆæ¬Šç¢¼çš„é™åˆ¶ã€‚
        - åœ¨ `auth_callback` è·¯ç”±ä¸­å¯¦ä½œæ™ºæ…§è§£æé‚è¼¯ï¼Œæ”¯æ´ç›´æ¥è²¼å…¥å®Œæ•´ Redirect URL æˆ–å–®ç¨ä»£ç¢¼ã€‚
    - æ†‘è­‰è®€å–éŸŒæ€§:
        - å»ºç«‹ `DB > .env` è®€å–å„ªå…ˆé †åºï¼Œç¢ºä¿ç¶²é è¨­å®šå€¼å„ªå…ˆæ–¼ç’°å¢ƒè®Šæ•¸ã€‚
        - å¯¦ä½œ `reload_token()` æ©Ÿåˆ¶ï¼Œç•¶æ–°çš„ Token å­˜å…¥è³‡æ–™åº«å¾Œè‡ªå‹•åˆ·æ–°å¾Œç«¯ `schwab_client` ç·©å­˜ï¼Œå¯¦ç¾ã€Œå…é‡å•Ÿä¼ºæœå™¨ã€å³æ™‚ç”Ÿæ•ˆã€‚
    - é€£ç·šè¨ºæ–·å¼·åŒ–: æ›´æ–° `get_auth_status` ç‚ºã€Œå¯¦æ™‚é©—è­‰ã€æ¨¡å¼ï¼Œé€éçœŸå¯¦ API å‘¼å« (get_linked_accounts) åµæ¸¬ Token æ˜¯å¦éæœŸï¼Œå¾¹åº•è§£æ±ºç‡ˆè™Ÿé¡¯ç¤ºã€Œå‡é™½æ€§ã€å•é¡Œã€‚
## 2026-01-22 - æ­·å²è³‡æ–™åŒ¯å…¥èˆ‡åœ–è¡¨ä¿®å¾© (Stage 1 å®Œæˆ)
1. ä¿®æ­£ CSV åŒ¯å…¥å™¨ (importer.py)ï¼š
   - æ–°å¢æ”¯æ´æ¨™æº– Balances æ ¼å¼ (è­˜åˆ¥ Amount æ¬„ä½)ã€‚
   - å¢åŠ æ•¸å€¼æ¸…æ´—é‚è¼¯ (ç§»é™¤ $, ", ,)ã€‚
   - ä¿®å¾©è³‡æ–™åº«äº¤æ˜“å•é¡Œï¼šè£œä¸Š db.commit()ï¼Œä¸¦åŠ å…¥é‡è¤‡è³‡æ–™æª¢æ¸¬ (Upsert)ï¼Œç¢ºä¿ 700+ ç­†æ­·å²è³‡æ–™æ­£ç¢ºå¯«å…¥ historical_balances è¡¨ã€‚
2. ä¿®æ­£åœ–è¡¨ API (analytics.py)ï¼š
   - å¯¦ä½œè³‡æ–™åˆä½µï¼šåŒæ™‚æŸ¥è©¢ AssetHistory (Live) èˆ‡ HistoricalBalance (CSV)ã€‚
   - è¨­å®šå„ªå…ˆæ¬Šï¼šè‹¥åŒä¸€å¤©æœ‰é‡è¤‡æ•¸æ“šï¼Œä»¥ Live æ•¸æ“šç‚ºæº–ã€‚
3. ç›®å‰ç‹€æ…‹ï¼š
   - æ­·å²è³‡ç”¢èµ°å‹¢åœ–å·²èƒ½å®Œæ•´é¡¯ç¤ºã€‚
   - æ–°èˆŠé›»è…¦é·ç§»å®Œæˆï¼Œç’°å¢ƒç¨ç«‹é‹ä½œä¸­ã€‚
4. ç›®å‰ç‹€æ…‹ï¼š
   - æ­·å²è³‡ç”¢èµ°å‹¢åœ–å·²èƒ½å®Œæ•´é¡¯ç¤ºã€‚
   - æ–°èˆŠé›»è…¦é·ç§»å®Œæˆï¼Œç’°å¢ƒç¨ç«‹é‹ä½œä¸­ã€‚

## 2026-01-22 - Stage 2: è‡ªå‹•å¿«ç…§åŠŸèƒ½ (å®Œå·¥)
1. åŠŸèƒ½å¯¦ä½œ (schwab_client.py)ï¼š
   - åœ¨ get_account_summary èˆ‡ get_account_positions æµç¨‹ä¸­åŠ å…¥è‡ªå‹•å­˜æª”é‚è¼¯ã€‚
   - å¯¦ä½œ Upsert (Insert/Update) æ©Ÿåˆ¶ï¼šè‹¥ç•¶æ—¥å·²æœ‰ç´€éŒ„å‰‡æ›´æ–°æ•¸å€¼ï¼Œç„¡ç´€éŒ„å‰‡æ–°å¢ã€‚
   - åŠ å…¥æ˜ç¢ºçš„ db.commit() èˆ‡ Log ç›£æ§ (ğŸ“¸, âœ…)ï¼Œç¢ºä¿æ•¸æ“šæŒä¹…åŒ–ã€‚
2. ç³»çµ±æœ€çµ‚ç‹€æ…‹ï¼š
   - [CSV åŒ¯å…¥]ï¼šä¿®å¾©å®Œæˆï¼Œå¯æ­£ç¢ºè§£æä¸¦åŒ¯å…¥æ­·å² Balancesã€‚
   - [åœ–è¡¨é¡¯ç¤º]ï¼šå¾Œç«¯å·²åˆä½µ Live èˆ‡ CSV æ­·å²æ•¸æ“šï¼Œèµ°å‹¢åœ–å®Œæ•´é€£è²«ã€‚
   - [è‡ªå‹•åŒ–]ï¼šLive Mode ä¸‹ï¼Œæ¯æ—¥è³‡ç”¢æ·¨å€¼æœƒè‡ªå‹•å¯«å…¥è³‡æ–™åº«ï¼Œç„¡éœ€æ‰‹å‹•å¹²é ã€‚

## 2026-01-23 - Stage 3: CSV åŒ¯å…¥åŠŸèƒ½é‡æ§‹ (æ‰‹å‹•æŒ‡å®šå¸³è™Ÿ)
1. ç­–ç•¥è®Šæ›´ (Strategy Shift)ï¼š
   - æ”¾æ£„ã€æ™ºæ…§é…å°ã€èˆ‡ã€æª”åè­˜åˆ¥ã€ï¼šå› ç„¡æ³•æ¶µè“‹æ‰€æœ‰æƒ…å¢ƒä¸”æ˜“å‡ºéŒ¯ã€‚
   - æ¡ç´ã€æ‰‹å‹•æŒ‡å®š (Explicit Selection)ã€ï¼šåŒ¯å…¥æ™‚ç”±ä½¿ç”¨è€…ç›´æ¥é¸æ“‡ç›®æ¨™å¸³è™Ÿã€‚
2. å…¨ç«¯å¯¦ä½œ (Full-Stack Implementation)ï¼š
   - [å‰ç«¯]ï¼šåœ¨ Settings é é¢æ–°å¢ Modal æµç¨‹ï¼Œä¸Šå‚³ CSV å‰éœ€å…ˆå¾ä¸‹æ‹‰é¸å–®é¸æ“‡å˜‰ä¿¡å¸³è™Ÿã€‚
   - [å¾Œç«¯]ï¼šAPI æ–°å¢æ¥æ”¶ account_hash åƒæ•¸ï¼ŒImporter é‚è¼¯ç°¡åŒ–ç‚ºç›´æ¥å¯«å…¥æŒ‡å®šå¸³è™Ÿã€‚
220 | - [è³‡æ–™åº«]ï¼šç¢ºèª AssetHistory çµæ§‹å·²åŒ…å« account_idï¼Œä¸” Upsert é‚è¼¯èƒ½æ­£ç¢ºéš”é›¢ä¸åŒå¸³è™Ÿçš„æ­·å²æ•¸æ“šã€‚
221 | 3. éŒ¯èª¤ä¿®å¾© (Fixes)ï¼š
222 | - ä¿®å¾© Settings.tsx ä¸­çš„ Unterminated JSX èªæ³•éŒ¯èª¤ã€‚
223 | - è§£æ±ºè·¨å¸³è™Ÿè³‡æ–™è¦†è“‹å•é¡Œã€‚
224 | - [2026-01-23] [Roo] ä¿®å¾©é¢¨éšªåˆ†æé é¢æŒ‡æ¨™ç‚º 0 çš„å•é¡Œï¼š
225 | - é‡æ§‹é¢¨éšªå¼•æ“ï¼šå°‡é¢¨éšªæŒ‡æ¨™è¨ˆç®—æ”¹ç‚ºã€ŒåŸºæ–¼é¤˜é¡çš„å‹•æ…‹è¨ˆç®—ã€ï¼Œç§»é™¤å° `daily_profit_loss` æ¬„ä½çš„ä¾è³´ã€‚
226 | - å¯¦ä½œå·¥å…·å‡½æ•¸ï¼šåœ¨ `risk.py` å¯¦ä½œåŸºæ–¼ `total_value` åºåˆ—èˆ‡ `pct_change()` çš„æ³¢å‹•ç‡ã€å¤æ™®æ¯”ç‡ã€MDD èˆ‡ VaR è¨ˆç®—ã€‚
227 | - æ›´æ–°åˆ†æç«¯é»ï¼šåœ¨ `analytics.py` æ–°å¢ `/risk-metrics` è·¯ç”±ï¼Œåˆä½µæ­·å²èˆ‡å³æ™‚æ•¸æ“šé€²è¡Œå‹•æ…‹é‹ç®—ã€‚
228 | - å‰ç«¯åŒæ­¥ï¼šæ›´æ–° `risk.ts` å‘¼å«æ–°ç«¯é»ï¼Œç¢ºä¿æŒ‡æ¨™èƒ½å¾æ­·å²é¤˜é¡è‡ªå‹•æ¨å°ã€‚
229 | - [2026-01-23] [Roo] **Stage 3 å®Œæˆ**ï¼šé¢¨éšªåˆ†æé é¢å·²é€éã€ŒåŸºæ–¼é¤˜é¡ã€çš„å‹•æ…‹è¨ˆç®—ä¿®å¾©ï¼Œæ•¸å€¼å·²é¡¯ç¤ºã€‚ä½†ç™¼ç¾ Account 1 å› å¤§é¡å…¥é‡‘å°è‡´å¤æ™®æ¯”ç‡ç•°å¸¸ (26.77)ï¼Œç¢ºèªéœ€è¦å¼•å…¥äº¤æ˜“ç´€éŒ„ä¾†ä¿®æ­£ã€‚
230 | - [2026-01-23] [Roo] **Stage 4 ç›®æ¨™**ï¼šå»ºç«‹ TransactionHistory è¡¨ï¼ŒåŒ¯å…¥äº¤æ˜“ç´€éŒ„ï¼Œä¸¦åˆ©ç”¨è³‡é‡‘æµ (Flows) ä¾†æ ¡æ­£é¢¨éšªè¨ˆç®—ã€‚
231 | - [2026-01-23] [Roo] **Stage 4 å®Œæˆ**ï¼šå»ºç«‹ TransactionHistory æ¨¡å‹èˆ‡ CSV åŒ¯å…¥å™¨ï¼ˆæ”¯æ´è¡Œè™Ÿå»é‡ï¼‰ï¼›å‰ç«¯ Settings é é¢æ–°å¢äº¤æ˜“åŒ¯å…¥å€å¡Šï¼›å¯¦ä½œ TWR ä¿®æ­£é‚è¼¯è§£æ±ºå¤§é¡å…¥é‡‘å°è‡´çš„é¢¨éšªæŒ‡æ¨™ç•°å¸¸ã€‚
232 | - [2026-01-23] [Roo] **Stage 5 å®Œæˆ**ï¼šå¯¦ä½œå…¨è‡ªå‹• API äº¤æ˜“åŒæ­¥èˆ‡èƒŒæ™¯æ’ç¨‹å™¨ï¼›é‡æ§‹æ™ºæ…§é¢¨éšªå¼•æ“ï¼Œåˆ©ç”¨æ¨¡ç³Šæ—¥æœŸå°é½Šèˆ‡ç²¾æº–è³‡é‡‘æµåµæ¸¬è§£æ±ºå¤æ™®æ¯”ç‡ç•°å¸¸å•é¡Œï¼Œé”æˆ Stable Release (v1.0)ã€‚

### Stage 5: å…¨è‡ªå‹•åŒ–èˆ‡æ™ºæ…§é¢¨éšªå¼•æ“ (Completed)
* **API è‡ªå‹•äº¤æ˜“åŒæ­¥ (Auto-Sync)**: å¯¦ä½œ `fetch_transactions`ï¼Œæ”¯æ´è‡ªå‹•æŠ“å–å˜‰ä¿¡æ­·å²äº¤æ˜“ç´€éŒ„ï¼Œä¸¦é€é `activityId` èˆ‡ Hash é€²è¡Œæ™ºæ…§å»é‡ã€‚
* **èƒŒæ™¯æ’ç¨‹å™¨ (Background Scheduler)**: å»ºç«‹ `task_scheduler.py`ï¼Œæ¯ 6 å°æ™‚è‡ªå‹•åŸ·è¡Œè³‡ç”¢å¿«ç…§èˆ‡äº¤æ˜“åŒæ­¥ï¼Œå¯¦ç¾ã€Œå…ç¶­è­·ã€é‹ä½œã€‚
* **æ™ºæ…§é¢¨éšªå¼•æ“ (Smart Risk Engine)**: é‡æ§‹ `risk.py`ï¼Œå¯¦ä½œ **TWR (æ™‚é–“åŠ æ¬Šå ±é…¬)** ç®—æ³•ã€‚
    * å¼•å…¥ **Fuzzy Date Matching** (æ¨¡ç³Šæ—¥æœŸå°é½Š) è§£æ±ºå…¥å¸³å»¶é²å•é¡Œã€‚
    * å¼•å…¥ **Smart Flow Detection** (æ™ºæ…§è³‡é‡‘æµåµæ¸¬)ï¼Œç²¾æº–å€åˆ†ã€Œå…¥é‡‘ã€èˆ‡ã€ŒæŠ•è³‡ç²åˆ©ã€ã€‚
    * æˆåŠŸä¿®å¾© Account 1 å¤æ™®æ¯”ç‡ç•°å¸¸ (24.33 -> 1.33) ä¸¦ä¿ç•™ Account 2 çš„é¸æ“‡æ¬Šç²åˆ©è¡¨ç¾ (0.68 -> 1.31)ã€‚

ç›®å‰ç³»çµ±ç‹€æ…‹ï¼š**Stable Release (v1.0)**ã€‚
